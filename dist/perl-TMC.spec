#
# build rpm from git, use 'git-build-rpm' :
# git build-rpm --rpm-dir /home/me/rpmbuild --dist .fc35
# the --rpm-dir is to save the .srpm file, the --dist is
# to avoid the longwinded version that is otherwise autogenerated
#

Name:           perl-TMC
Version:        0.06
Release:        5%{?dist}
Summary:        TMC Perl module
License:        GPL
Group:          Development/Libraries
URL:            https://github.com/celane/perl-TMC
Source0:        %{name}-%{version}.tar.gz
BuildRoot:      %{_tmppath}/%{name}-%{version}-%{release}-root
BuildArch:      noarch
BuildRequires:  perl >= 0:5.006
BuildRequires:  perl(ExtUtils::MakeMaker)
BuildRequires:  perl(Test::More)
Requires:       perl(:MODULE_COMPAT_%(eval "`%{__perl} -V:version`"; echo $version))
Requires:       linux-usbtmc
Requires:       perl-ph

%description
perl TMC module for USBTMC data aquisition, plus 
associated programs for Tek2024B scope aquisition and control.


%prep
%autosetup

%build
%{__perl} Makefile.PL INSTALLDIRS=vendor
make %{?_smp_mflags}

%install
rm -rf $RPM_BUILD_ROOT

make pure_install PERL_INSTALL_ROOT=$RPM_BUILD_ROOT

find $RPM_BUILD_ROOT -type f -name .packlist -exec rm -f {} \;
find $RPM_BUILD_ROOT -depth -type d -exec rmdir {} 2>/dev/null \;

%{_fixperms} $RPM_BUILD_ROOT/*

install -d $RPM_BUILD_ROOT%{_bindir}
install programs/Get2024Config     $RPM_BUILD_ROOT%{_bindir}
install programs/Set2024Config     $RPM_BUILD_ROOT%{_bindir}
install programs/ScreenCap2024     $RPM_BUILD_ROOT%{_bindir}
install programs/Take2024Waveforms $RPM_BUILD_ROOT%{_bindir}
install programs/TMCreset          $RPM_BUILD_ROOT%{_bindir}
install -d $RPM_BUILD_ROOT/%{_mandir}/man1/
install programs/*.1 $RPM_BUILD_ROOT/%{_mandir}/man1/

%check
#make test

%files
%defattr(-,root,root,-)
%doc Changes README.md
%{perl_vendorlib}/*
%{_mandir}/man3/*
%{_mandir}/man1/*
%{_bindir}/*

%pre
h2ph -a linux/usb/tmc.h
h2ph -a linux/ioctl.h
h2ph -a linux/usbdevice_fs.h

%changelog
* Thu Jan 12 2023 lane@dchooz.org 0.06-4
- move to github, use filetest pragma for device files with ACLs

* Thu Jan 21 2016 lane@duphy4.physics.drexel.edu 0.05-1
- fix bugs, add TMCreset script, manpages

* Thu Jan 14 2016 lane@duphy4.physics.drexel.edu 0.01-1
- Specfile autogenerated by cpanspec 1.78.
